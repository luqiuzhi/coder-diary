# 系统集成中增加接口的调用和被调用的容错性

大部分系统集成时，使用RESTful接口是一种简单有效的方式。

## 作为调用方

1. 外部接口的可配置性。可以动态的更新接口地址。
2. 重试机制。通过spring-retry或resilience4j-retry这类重试框架实现。
3. 超时控制。如果下游接口响应时间过长，在不配置接口请求超时的情况下，容易引起线程阻塞，导致线程池资源耗尽，进而影响到应用本体。
4. 服务熔断。如果下游服务出现长时间的请求异常或者网络环境不通，可以使用熔断器减少请求次数。涉及到的框架：spring-cloud-netflix-hystrix/resilience4j-circuitbreaker/spring-cloud-circuit-breaker（使用resilience4j或spring-retry实现）
5. 异步处理。调用时不要求服务提供方直接返回结果，而是返回一个任务ID，调用方可以通过任务ID查询结果。（使用较少）

## 作为被调用方

1. 接口设计清晰和文档齐全。
2. 自我保护机制。例如限流（Resilience4j-Ratelimiter：方法级别的限流；Spring Cloud Gateway / Sentinel：网关级别的限流），权限认证（令牌管理）
3. 接口幂等性。
4. 参数校验。使用bean validation做初步校验，复杂逻辑使用业务逻辑校验。
5. 语言相同的情况下可以提供封装好的SDK，减少调用过程中的不规范行为。
6. 监控日志。提供唯一的request-id，方便后续问题排查。