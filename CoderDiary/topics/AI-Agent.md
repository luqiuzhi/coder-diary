# AI Agent 的通用架构

一个功能完善的AI Agent可以看作是一个**自主的、具备感知-决策-行动循环的智能系统**。其核心架构通常包含以下五个关键组件，它们协同工作，使Agent能够理解目标、处理信息并执行任务。

## AI Agent 的核心组件

### 1. 规划模块
这是Agent的“大脑”或“推理引擎”。它负责消化信息、制定计划、做出决策。
*   **子组件与功能：**
    *   **目标理解与分解：** 解析用户或系统给出的高级指令（如“为我策划一个北京三日游”），并将其分解为一系列具体的、可执行的子任务（如：查天气、找酒店、规划景点路线、预订机票等）。
    *   **战略规划：** 决定完成任务的**最佳顺序和策略**。例如，是先订机票还是先订酒店？是否需要多步推理？
    *   **工具选择：** 决定在每一步子任务中，需要调用哪个“工具”（见下文）来执行。例如，要查天气，就调用“天气API工具”；要搜索信息，就调用“网络搜索工具”。
    *   **反思与调整：** 根据“记忆模块”中的历史记录和“执行模块”的反馈，评估当前计划的进展，并在遇到障碍时动态调整策略。

### 2. 记忆模块
这是Agent的“知识库”和“工作记事本”。它存储了Agent与外界交互的所有历史信息。
*   **子组件与功能：**
    *   **短期记忆/上下文：** 保存当前会话或任务周期内的完整交互历史（包括用户指令、Agent的思考过程、工具调用及结果）。这直接提供给大模型作为决策的上下文。
    *   **长期记忆/向量数据库：** 存储超越当前上下文的重要信息。通常使用向量数据库，可以高效地进行语义搜索。例如，存储用户偏好（“不喜欢面食”）、之前任务的关键结论、或从文档中学到的知识。当遇到相关问题时，可以从这里检索信息。
    *   **外部知识源：** 虽然不是严格意义上的“记忆”，但Agent可以通过工具（如网络搜索、数据库查询）来访问外部的、非固有的知识，弥补其内部知识的不足。

### 3. 工具模块
这是Agent的“双手”和“感官延伸”。它使Agent能够与外部世界互动，突破纯文本模型的限制。
*   **功能：**
    *   提供一系列可供调用的**API、函数或服务**。
    *   **常见工具示例：**
        *   **计算器：** 执行数学运算。
        *   **代码解释器：** 执行代码（如Python）来处理数据或生成图表。
        *   **网络搜索API：** 获取实时信息。
        *   **数据库查询接口：** 访问结构化数据。
        *   **软件API：** 如发送邮件、操作日历、控制智能家居。
        *   **文件系统操作：** 读取、写入、修改文件。

### 4. 行动模块
这是Agent的“执行单元”。它负责将“规划模块”的决策转化为具体的行动。
*   **功能：**
    *   **调用工具：** 根据规划模块的指令，以正确的参数格式调用“工具模块”中的特定工具。
    *   **生成响应：** 当需要与用户沟通时（如汇报进度、提出问题、给出最终答案），该模块负责组织语言，生成自然、人性化的回复。

### 5. 感知模块
这是Agent的“感官系统”。它负责接收和理解来自外部环境的输入。
*   **功能：**
    *   **多模态输入理解：** 不仅限于文本。它可以集成视觉、语音等多模态模型，来理解用户上传的图片、音频、视频、PDF文档、PPT等。
    *   **信息提取与结构化：** 从复杂的输入源中提取关键信息，并将其转化为规划模块能够处理的结构化格式。

---

## 各组件之间的交互流程

这些组件通过一个经典的 **“感知-规划-行动”循环** 紧密协作。我们可以通过一个具体的例子来理解这个流程：

**用户指令：** “帮我找出公司上个季度销售额最高的产品，并给我老板写一份总结邮件。”

1.  **【感知】**
    *   感知模块接收到用户的文本指令。
    *   它对其进行初步解析，并将理解后的意图传递给规划模块。

2.  **【规划 & 调用记忆】**
    *   **规划模块**开始工作：
        *   **目标分解：** 将任务分解为：a) 查询数据库获取上季度销售数据；b) 找出最高销售额的产品；c) 撰写邮件草稿。
        *   **工具选择：** 决定步骤a需要调用“数据库查询工具”，步骤c由大模型自身完成。
        *   **检索记忆：** 规划模块可能会要求**记忆模块**检索相关信息，例如：“老板的邮箱地址是什么？”或者“公司对销售报告的格式有何偏好？”。记忆模块从长期记忆中检索出这些信息并返回给规划模块。

3.  **【行动】**
    *   **行动模块**接收到规划模块的明确指令：“调用数据库查询工具，执行SQL：`SELECT * FROM sales WHERE quarter='Q2'`”。
    *   行动模块找到对应的**工具模块**中的数据库工具，传入参数并执行调用。

4.  **【观察结果 & 再次规划】**
    *   工具模块执行查询，返回一个结构化的数据结果（例如，一个表格）。
    *   这个结果被送回到**规划模块**。
    *   规划模块“观察”到这个结果，并进行下一步规划：
        *   它分析数据，确认了销售额最高的产品是“产品A”。
        *   然后它规划下一步：现在需要撰写邮件了。它可能会再次检索记忆，获取邮件模板或老板的称呼习惯。

5.  **【循环与反思】**
    *   规划模块将“产品A的销售数据”和“邮件撰写要求”整合，生成最终的邮件内容。
    *   **（可选反思）** 一个高级的Agent可能会在发送前，进行一步“反思”：“这封邮件是否清晰地表达了重点？数据准确吗？”它可能会调用一个“文本校对工具”或再次内部评估。
    *   最终，行动模块将生成的邮件内容输出给用户，或者直接调用“邮件发送工具”将邮件发出。

## 总结与图示

整个交互流程可以简化为一个循环：

**感知 → 规划 → 行动 → 观察 → 再规划 → ...**

```
用户输入
    ↓
[感知模块] -> 理解指令
    ↓
[规划模块] <-> [记忆模块] (检索相关记忆，存储当前交互)
    ↓ (制定计划，选择工具)
[行动模块]
    ↓ (调用工具)
[工具模块] -> 与外部世界交互并返回结果
    ↓ (观察结果)
[规划模块] (评估结果，决定下一步)
    ↓
-- 循环，直到任务完成 --
    ↓
[行动模块] -> 生成最终响应给用户
```

这种**模块化架构**的优势在于：
*   **清晰解耦：** 每个组件各司其职，易于维护和升级（例如，可以单独改进工具库或记忆系统）。
*   **强大灵活：** 通过工具模块，Agent的能力可以无限扩展。
*   **具备持续性：** 记忆模块使得Agent能够拥有“个人经历”，实现跨会话的个性化服务。

最终，一个AI Agent的智能程度，不仅取决于其核心大模型的能力，更取决于这五大组件设计的精巧程度和它们之间协同工作的效率。