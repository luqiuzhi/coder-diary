# Oracle基础概念

## 宏观理解

在学习细节之前，请先建立一个宏观图像：

*   **数据库（Database）**：可以看作是一个**物理仓库**。它包含了所有的实际数据文件、控制文件、日志文件等，是静态的、物理的存在。
*   **实例（Instance）**：可以看作是**仓库的管理和运营团队**。这个团队在内存中工作，负责调度、处理订单、维护仓库秩序。它是动态的、存在于内存中的。

**关键点**：一个“运营团队”（实例）在某一时刻只能管理一个“物理仓库”（数据库）。但在Oracle高可用架构（如RAC）中，多个“团队”（多个实例）可以协同管理同一个“大仓库”（一个数据库），以实现负载均衡和高可用性。对于初学者，先理解“一个实例对应一个数据库”即可。

---

## Oracle数据库最重要的几个基本概念

### 1. 实例（Instance）

实例是访问数据库的通道和引擎。当你说“启动Oracle数据库”时，实际上你启动的是实例，然后由实例去挂载并打开数据库。实例主要由两部分组成：

*   **内存结构（Memory Structures）**：
    *   **系统全局区（SGA）**：这是实例的核心，是所有用户共享的内存区域。可以把它想象成公司的“中央办公区”。
        *   **数据库缓冲区缓存（Database Buffer Cache）**：最重要的部分。数据从磁盘读出来后，会在这里缓存。后续的查询和修改都优先在这里进行，极大地提升了性能。就像是一个“高频货物暂存区”。
        *   **共享池（Shared Pool）**：缓存执行过的SQL语句、存储过程以及数据字典信息等。目的是为了复用，避免重复解析相同的SQL，提高效率。像是“工作方案和客户信息的档案室”。
        *   **重做日志缓冲区（Redo Log Buffer）**：临时存放所有对数据块修改记录的小块内存。任何“改动”都会先记录在这里。
*   **后台进程（Background Processes）**：
    *   这些是默默无闻的“后台工人”，维持着数据库的稳定运行。
        *   **PMON（进程监控进程）**：清洁工。负责清理失败的用户进程，释放其占用的资源。
        *   **SMON（系统监控进程）**：维修工。负责实例恢复、清理临时空间等系统级维护工作。
        *   **DBWn（数据库写进程）**：搬运工。负责将“缓冲区缓存”中修改过的数据块写入到磁盘上的数据文件中。**注意**：它不是随时写，而是批量、延迟写入，这是Oracle高性能的关键之一。
        *   **LGWR（日志写进程）**：速记员。负责将“重做日志缓冲区”里的内容快速写入到**重做日志文件**中。这个操作非常频繁且快速，是保证数据不丢失的关键。

### 2. 数据库（Database）

数据库是数据的物理存储，主要由以下几类文件构成：

*   **数据文件（Data Files）**：真正存储表、索引等用户数据的地方。就像仓库里的货架。
*   **控制文件（Control File）**：数据库的“大脑”或“地图”。它记录了数据库的物理结构信息，如数据库名称、数据文件和重做日志文件的位置等。实例靠它来找到和管理数据库。**非常重要，通常需要多路复用（多个副本）**。
*   **重做日志文件（Redo Log Files）**：记录所有对数据库更改操作的“流水账”。通常是两组或多组，循环使用。LGWR进程不断写入。它的主要目的是用于**数据恢复**。如果数据库崩溃，可以利用重做日志来重做所有已提交的事务，确保数据不丢失。
*   **参数文件（Parameter File）**：实例的“启动配置文件”（如`spfile<sid>.ora`）。它告诉实例SGA应该开多大，DBWn进程开几个，控制文件在哪里等等。没有它，实例就无法启动。

### 3. 表空间（Tablespace）与 数据文件（Data Files）的关系

这是Oracle逻辑存储和物理存储的桥梁，非常重要！

*   **表空间（Tablespace）**：一个**逻辑存储容器**。你在创建表、索引时，指定它们存放在哪个表空间里，而不是直接指定存放在哪个物理文件上。例如：`USERS`表空间存放用户数据，`SYSTEM`表空间存放系统数据。
*   **数据文件（Data File）**：表空间的**物理实现**。一个表空间由一个或多个数据文件组成。一个数据文件只能属于一个表空间。

**比喻**：表空间就像是你电脑上的C盘、D盘（逻辑分区），而数据文件就是C盘下的`pagefile.sys`、`Program Files`文件夹等实际占用磁盘空间的物理文件。

**为什么重要？**：这种逻辑与物理的分离，使得数据库管理变得非常灵活。你可以为不同用途的数据创建不同的表空间（如历史数据、交易数据），并放在不同的物理磁盘上以提升性能。你可以通过为表空间增加新的数据文件来轻松扩容。

### 4. 模式（Schema）与 用户（User）

这两个概念紧密相连，初学者经常混淆。

*   **用户（User）**：一个能够连接到数据库的**账户**。它拥有用户名和密码。
*   **模式（Schema）**：该用户所拥有的**所有数据库对象的集合**。这些对象包括表、视图、索引、存储过程、序列等。

**关键点**：**一旦创建了一个用户，系统就会自动创建一个与该用户同名的模式**。当你用这个用户登录后，你创建的所有表、视图等都会放在你自己的模式里。

**例子**：
用户 `SCOTT` 登录后创建了一张表 `EMP`。那么这张表的全名就是 `SCOTT.EMP`。
如果另一个用户 `HR` 想访问这张表，他必须使用 `SCOTT.EMP` 来引用，并且需要被授予相应的权限。

### 5. 关键逻辑存储结构（从大到小）

理解数据在逻辑上是如何组织的：

*   **数据库（Database）** -> **表空间（Tablespace）** -> **段（Segment）** -> **区（Extent）** -> **数据块（Data Block）**

    *   **段（Segment）**：分配给一个特定数据库对象（如一张表、一个索引）的存储空间。一张表对应一个数据段，一个索引对应一个索引段。
    *   **区（Extent）**：段是由一个或多个“区”组成的。区是连续分配的一组数据块。当段需要更多空间时，Oracle会为其分配一个新的区。
    *   **数据块（Data Block）**：Oracle存储和管理数据的最小、最精细的单位。它是Oracle从磁盘读写数据的基本单元。**注意**：它和操作系统的块不同，通常更大（如8KB）。

---

